$nomention
$c[==================== ğŸ‰ SISTEMA GIVEAWAYS - ONINTERACTION ====================]
$time[America/New_York] $c[Hora base: Nueva York (timestamps consistentes)]

$onlyPerms[admin;âŒ No tienes permisos para administrar giveaways]

$c[======= âš ï¸ ADVERTENCIA âš ï¸ ========]
$c[===== El modificar/hacer uso indebido o intentar aprovecharse de este sistema esta prohibido en nuestros TÃ©rminos y condiciones del uso del servicio. Si detectamos actividad inusual de algun usuario, cuenta o IP/Dispositivo, bloquearemos el acceso y eliminaremos su cuenta de nuestro servicio sin previo aviso y sin posibilidad de quitar el baneo. Â¡NO MODIFIQUES NADA!]
$var[api;https://pmifbvtzqejujixarusq.supabase.co/functions/v1/giveaway]
$c[======= âš ï¸ ADVERTENCIA âš ï¸ ========]

$c[======= ğŸŸ¢ TOKEN ğŸŸ¢ ========]
$var[token;TU_TOKEN_AQUI]
$c[Coloca el token que te dimos al acceder en nuestro portal]

$c[================= CHEQUEOS PREVIOS OBLIGATORIOS =================]
$c[1) Validar que exista la variable JSON sysgive]
$if[$getVar[sysgive;$authorID]==]
  $ephemeral
  $title[âŒ | Falta configuraciÃ³n inicial]
  $description[No tienes configurada la variable **sysgive** para tu usuario.  

Por favor, crea primero la variable con el valor por defecto:

\`\`\`json
{"estado":"0","canal":"No","time":"0","create":"No","token":"No","id":"0","win":"1"}
\`\`\`

Luego vuelve a intentar.]
  $color[#FF4D4F]
  $footer[Giveaway System By Methdev]
  $stop
$endif

$c[2) ValidaciÃ³n del token de ejecuciÃ³n]
$if[$var[token]==TU_TOKEN_AQUI]
  $ephemeral
  $title[âŒ | Token no configurado]
  $description[Debes configurar tu **token personal** en el cÃ³digo antes de usar este sistema.  
â¡ï¸ Reemplaza \`TU_TOKEN_AQUI\` por el token asignado en nuestro portal.]
  $color[#FF0000]
  $footer[Giveaway System By Methdev]
  $stop
$else
  $jsonParse[$getVar[sysgive;$authorID]]
  $jsonSetString[token;Si]
  $setVar[sysgive;$jsonStringify;$authorID]
$endif

$c[==========================================================================]
$c[                             PANEL PRINCIPAL                              ]
$c[==========================================================================]

$if[$customID==gw-main-$authorID]
  $jsonParse[$getVar[sysgive;$authorID]]
  $jsonSetString[estado;1]
  $setVar[sysgive;$jsonStringify;$authorID]

  $ephemeral
  $var[estadoTexto;ğŸŸ¢ Activado]
  $title[ğŸ‰ Panel de AdministraciÃ³n de Giveaways]
  $description[Usa los botones para gestionar los giveaways:

ğŸ”¹ Estado actual del sistema: $var[estadoTexto]

1ï¸âƒ£ **Gestionar Giveaway** â€“ Ver y controlar un giveaway existente.  
2ï¸âƒ£ **Crear Giveaway** â€“ Inicia un nuevo giveaway en el servidor.  
3ï¸âƒ£ **Terminar Giveaway** â€“ Finaliza un giveaway activo.]
  $color[#5865F2]
  $image[https://pub-ce3d0244548c433e95b2def1395a0e7a.r2.dev/MethDevLogo.gif]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;gw-main1-$authorID;ğŸ›‘ Desactivar;danger;;;]
  $addButton[no;manage_gw-$authorID;ğŸ› ï¸ Gestionar;success;;;]
  $addButton[no;create_gw-$authorID;â• Crear;success;;;]
  $addButton[no;end_gw-$authorID;ğŸ›‘ Terminar;danger;;;]

$elseif[$customID==gw-main1-$authorID]
  $jsonParse[$getVar[sysgive;$authorID]]
  $jsonSetString[estado;0]
  $setVar[sysgive;$jsonStringify;$authorID]

  $ephemeral
  $var[estadoTexto;ğŸ”´ Desactivado]
  $title[ğŸ‰ Panel de AdministraciÃ³n de Giveaways]
  $description[Usa los botones para gestionar los giveaways:

ğŸ”¹ Estado actual del sistema: $var[estadoTexto]

1ï¸âƒ£ **Gestionar Giveaway** â€“ Ver y controlar un giveaway existente.  
2ï¸âƒ£ **Crear Giveaway** â€“ Inicia un nuevo giveaway en el servidor.  
3ï¸âƒ£ **Terminar Giveaway** â€“ Finaliza un giveaway activo.]
  $color[#5865F2] 
  $image[https://pub-ce3d0244548c433e95b2def1395a0e7a.r2.dev/MethDevLogo.gif]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;gw-main-$authorID;ğŸŸ¢ Activar;success;;;]
  $addButton[no;manage_gw-$authorID;ğŸ› ï¸ Gestionar;success;;;]
  $addButton[no;create_gw-$authorID;â• Crear;success;;;]
  $addButton[no;end_gw-$authorID;ğŸ›‘ Terminar;danger;;;]
$endif

$c[==========================================================================]
$c[                             GESTIONAR (MENÃš)                             ]
$c[==========================================================================]

$if[$customID==manage_gw-$authorID]
  $clear
  $ephemeral
  $title[ğŸ› ï¸ Gestionar Giveaway]
  $description[Este menÃº te permite gestionar tus giveaways activas asÃ­ como publicar el post para permitir a tus usuarios participar.

Selecciona una opciÃ³n para continuar.]
  $color[#00BFFF]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $newSelectMenu[gw-man;1;1;ğŸ“ Mostrar Opciones]
  $addSelectMenuOption[gw-man;Ver Detalles;gw-view;Consultar datos de un giveaway;no;ğŸ“„]
  $addSelectMenuOption[gw-man;Publicar;gw-pub;Publica tu Giveaway;no;ğŸ“¢]
  $addSelectMenuOption[gw-man;MenÃº Principal;gw-back;Regresa al panel;no;ğŸ”™]
$endif

$c[==========================================================================]
$c[                              CREAR GIVEAWAY                              ]
$c[==========================================================================]

$if[$customID==create_gw-$authorID]
  $jsonParse[$getVar[sysgive;$authorID]]

  $var[canalTexto;No establecido âŒ]
  $if[$json[canal]!=No]
    $var[canalTexto;<#$json[canal]>]
  $endif

  $var[tiempoTexto;No establecido âŒ]
  $if[$json[time]!=0]
    $var[tiempoTexto;Establecida ğŸŸ¢ | <t:$json[time]:F> (<t:$json[time]:R>)]
  $endif

  $var[crearTexto;El usuario no puede crear giveaways âŒ]
  $if[$json[create]!=No]
    $var[crearTexto;El usuario puede crear giveaways ğŸŸ¢]
  $endif

  $ephemeral
  $title[ğŸ§© | Crear Giveaway]
  $description[Selecciona una opciÃ³n para continuar.

Datos definidos:

ğŸ”¹ Canal giveaways: $var[canalTexto]  
ğŸ”¹ Tiempo giveaways: $var[tiempoTexto]  
ğŸ”¹ Â¿Puede crear?: $var[crearTexto]]
  $color[#00BFFF]
  $image[https://pub-ce3d0244548c433e95b2def1395a0e7a.r2.dev/MethDevLogo.gif]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $newSelectMenu[gw-crt;1;1;ğŸ“ Mostrar Opciones]
  $addSelectMenuOption[gw-crt;Definir Canal;gw-chn;Define el canal a usar;no;ğŸ·ï¸]
  $addSelectMenuOption[gw-crt;Definir DuraciÃ³n;gw-time;Define la duraciÃ³n del giveaway;no;â±ï¸]
  $addSelectMenuOption[gw-crt;Crear Giveaway;gw-creategw;Crea tu giveaway;no;ğŸ§©]
  $addSelectMenuOption[gw-crt;MenÃº Principal;gw-back;Regresa al panel;no;ğŸ”™]
$endif

$if[$message==gw-chn]
  $jsonParse[$getVar[sysgive;$authorID]]
  $ephemeral
  $newModal[modal-gw-chn;ğŸ·ï¸ | Definir Canal]
  $addTextInput[id;short;ID del canal;;;yes;$json[canal];Ej: 12345]
$endif

$if[$customID==modal-gw-chn]
  $jsonParse[$getVar[sysgive;$authorID]]
  $onlyIf[$isNumber[$input[id]]==true;âŒ El **ID** debe ser numÃ©rico]
  $jsonSetString[canal;$input[id]]
  $setVar[sysgive;$jsonStringify;$authorID]

  $ephemeral
  $title[ğŸ·ï¸ Canal definido]
  $description[Se ha definido el canal **<#$input[id]>** para tus futuros giveaways.]
  $color[#9D4EDD]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;create_gw-$authorID;â†©ï¸ Regresar;primary;;;]
$endif

$c[==========================================================================]
$c[                       DEFINIR TIEMPOS DEL GIVEAWAY                       ]
$c[==========================================================================]

$if[$message==gw-time]
  $ephemeral
  $title[â±ï¸ | Definir tiempo]
  $description[Selecciona una de las siguientes opciones de duraciÃ³n para tu prÃ³ximo giveaway:]
  $color[#00BFFF]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $newSelectMenu[gw-time;1;1;ğŸ“ Mostrar Opciones]
  $addSelectMenuOption[gw-time;â±ï¸ 30 minutos;gw-30m;DurarÃ¡ 30 minutos;no;ğŸ•›]
  $addSelectMenuOption[gw-time;â±ï¸ 1 Hora;gw-1h;DurarÃ¡ 1 hora;no;ğŸ•‘]
  $addSelectMenuOption[gw-time;â±ï¸ 1 DÃ­a;gw-1day;DurarÃ¡ 1 dÃ­a;no;ğŸ•Ÿ]
  $addSelectMenuOption[gw-time;MenÃº Principal;gw-back;Regresa al panel;no;ğŸ”™]
$endif

$if[$message==gw-30m]
  $var[unix;$sum[$getTimestamp;1800]]
  $jsonParse[$getVar[sysgive;$authorID]]
  $jsonSetString[time;$var[unix]]
  $jsonSetString[create;Si]
  $setVar[sysgive;$jsonStringify;$authorID]

  $ephemeral
  $title[â±ï¸ Tiempo definido]
  $description[Se ha definido el tiempo de tu siguiente giveaway a <t:$var[unix]:F> (<t:$var[unix]:R>)]
  $color[#00BFFF]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;create_gw-$authorID;â†©ï¸ Regresar;primary;;;]

$elseif[$message==gw-1h]
  $var[unix;$sum[$getTimestamp;3600]]
  $jsonParse[$getVar[sysgive;$authorID]]
  $jsonSetString[time;$var[unix]]
  $jsonSetString[create;Si]
  $setVar[sysgive;$jsonStringify;$authorID]

  $ephemeral
  $title[â±ï¸ Tiempo definido]
  $description[Se ha definido el tiempo de tu siguiente giveaway a <t:$var[unix]:F> (<t:$var[unix]:R>)]
  $color[#00BFFF]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;create_gw-$authorID;â†©ï¸ Regresar;primary;;;]

$elseif[$message==gw-1day]
  $var[unix;$sum[$getTimestamp;86400]]
  $jsonParse[$getVar[sysgive;$authorID]]
  $jsonSetString[time;$var[unix]]
  $jsonSetString[create;Si]
  $setVar[sysgive;$jsonStringify;$authorID]

  $ephemeral
  $title[â±ï¸ Tiempo definido]
  $description[Se ha definido el tiempo de tu siguiente giveaway a <t:$var[unix]:F> (<t:$var[unix]:R>)]
  $color[#00BFFF]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;create_gw-$authorID;â†©ï¸ Regresar;primary;;;]
$endif

$c[==========================================================================]
$c[                       COMPROBACIONES ANTES DE CREAR                      ]
$c[==========================================================================]

$if[$message==gw-creategw]
  $jsonParse[$getVar[sysgive;$authorID]]
  $var[now;$getTimestamp]

  $if[$json[canal]==No]
    $ephemeral
    $title[âŒ | Sin canal establecido]
    $description[Debes definir un canal antes de crear el giveaway.]
    $color[#00BFFF]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;create_gw-$authorID;â†©ï¸ Regresar;primary;;;]

  $elseif[$json[time]==0]
    $ephemeral
    $title[âŒ | Sin tiempo establecido]
    $description[Debes definir un tiempo antes de crear el giveaway.]
    $color[#00BFFF]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;create_gw-$authorID;â†©ï¸ Regresar;primary;;;]

  $elseif[$json[time]<$var[now]]
    $ephemeral
    $title[âŒ› | Tiempo caducado]
    $description[El tiempo definido ya ha pasado, selecciona uno nuevo.]
    $color[#00BFFF]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;create_gw-$authorID;â†©ï¸ Regresar;primary;;;]

  $else
    $newModal[modal-gw-create;ğŸ§© | Crear Giveaway]
    $addTextInput[prize;short;Premio (ej: Nitro 1 mes);;;no;;]
  $endif
$endif

$if[$customID==modal-gw-create]
  $ephemeral
  $jsonParse[$getVar[sysgive;$authorID]]
  $onlyIf[$input[prize]!=;âŒ Debes indicar un **premio**]

  $httpGet[$var[api]/create?token=$var[token]&guild=$guildID&channel=$json[canal]&msgid=$messageID&createdby=$authorID&prize=$url[encode;$input[prize]]&winners=1&ends=$json[time]]
  $jsonSetString[id;$httpResult[data;id]]
  $setVar[sysgive;$jsonStringify;$authorID]

  $title[âœ… Giveaway Creado]
  $description[Se ha creado un giveaway en <#$json[canal]> 
ğŸ **Premio:** $input[prize]  
â³ **DuraciÃ³n:** <t:$json[time]:F> (<t:$json[time]:R>)]
  $color[#00FF7F]
  $image[https://pub-ce3d0244548c433e95b2def1395a0e7a.r2.dev/MethDevLogo.gif]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;gw-save-$authorID;ğŸ’¾ Guardar Giveaway;primary;;;]
  $addButton[no;gw-main-$authorID;â†©ï¸ MenÃº Principal;primary;;;]
$endif

$if[$customID==gw-save-$authorID]
  $ephemeral
  $title[ğŸ’¾ | Giveaway Guardado]
  $description[Tu giveaway ha sido guardado con Ã©xito. Ahora ve al canal donde quieras publicarlo y usa â€” Gestionar â†’ Publicar.]
  $color[#00BFFF]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;gw-main-$authorID;â†©ï¸ MenÃº Principal;primary;;;]
$endif

$c[==========================================================================]
$c[                                 TERMINAR                                 ]
$c[==========================================================================]

$if[$customID==end_gw-$authorID]
  $jsonParse[$getVar[sysgive;$authorID]]
  $var[time;$getTimestamp]
  $httpGet[$var[api]/$json[id]/draw?token=$var[token]]
 
  $if[$httpResult[success]==true]
    $title[âœ… Giveaway Finalizado]
    $description[El giveaway ha sido terminado.]
    $addField[ğŸ‰ GANADOR;<@$httpResult[data;winners;0;user_id]>;false]
    $color[#FF6347]
    $image[https://pub-ce3d0244548c433e95b2def1395a0e7a.r2.dev/MethDevLogo.gif]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $jsonSetString[id;0]
    $jsonSetString[time;0]
    $jsonSetString[create;No]
    $setVar[sysgive;$jsonStringify;$authorID]
  $else
    $title[ğŸš« | Giveaway finalizado]
    $description[Este sorteo ya ha finalizado]
    $addField[Finaliza;<t:$json[time]:F> (<t:$json[time]:R>);false]
    $color[#9D4EDD]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
  $endif
$endif

$c[==========================================================================]
$c[                             VOLVER AL MENÃš                               ]
$c[==========================================================================]

$if[$message==gw-back]
  $title[ğŸ‰ Panel de AdministraciÃ³n de Giveaways]
  $description[Usa los botones para gestionar los giveaways:

1ï¸âƒ£ **Gestionar Giveaway** â€“ Ver y controlar un giveaway existente.  
2ï¸âƒ£ **Crear Giveaway** â€“ Inicia un nuevo giveaway en el servidor.  
3ï¸âƒ£ **Terminar Giveaway** â€“ Finaliza un giveaway activo.]
  $color[#5865F2]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;manage_gw-$authorID;ğŸ› ï¸ Gestionar;success;;;]
  $addButton[no;create_gw-$authorID;â• Crear;success;;;]
  $addButton[no;end_gw-$authorID;ğŸ›‘ Terminar;danger;;;]
$endif

$c[==========================================================================]
$c[                           VER DETALLES (VIEW)                            ]
$c[==========================================================================]

$if[$message==gw-view]
  $jsonParse[$getVar[sysgive;$authorID]]
  $var[id;$json[id]]
  $httpGet[$var[api]/$json[id]?token=$var[token]]

  $if[$var[id]!=0]
    $title[ğŸ“‹ Detalles del Giveaway]
    $description[
ğŸ Premio: **$httpResult[data;prize]**  
â³ Finaliza: <t:$json[time]:F> (<t:$json[time]:R>)  
ğŸ“Œ Estado: **$httpResult[data;status]**]
    $color[#FFD700]
    $image[https://pub-ce3d0244548c433e95b2def1395a0e7a.r2.dev/MethDevLogo.gif]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;gw-main-$authorID;â†©ï¸ MenÃº Principal;primary;;;]
  $else
    $title[ğŸš« No hay detalles]
    $description[En este momento no se encuentra registrada ninguna Giveaway, inicia una para poder ver los detalles]
    $color[#FFD700]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;gw-main-$authorID;â†©ï¸ MenÃº Principal;primary;;;]
  $endif
$endif

$c[==========================================================================]
$c[                         PUBLICAR GIVEAWAY (PUB)                          ]
$c[==========================================================================]

$if[$message==gw-pub]
  $jsonParse[$getVar[sysgive;$authorID]]
  
  $if[$isSlash==true]
    $title[â›” | Post EfÃ­mero]
    $description[EstÃ¡s intentando hacer el post de tu giveaway usando el modo efÃ­mero por lo cual nadie mÃ¡s que tÃº lo podrÃ¡ ver, ejecuta el comando .giveaway y intenta de nuevo hacer el Post de tu giveaway. Puedes ver una preview de tu giveaway]
    $addField[âŒ› DuraciÃ³n;<t:$json[time]:F> (<t:$json[time]:R>);false]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;gw-post-$authorID;ğŸ“¢ Preview Giveaway;primary;;;]
    $addButton[no;gw-exit-$authorID;ğŸš« Cancelar proceso;danger;;;]
  $else
    $title[ğŸ“¢ | Publicar Completado]
    $description[EstÃ¡s a punto de publicar tu giveaway.  
AsegÃºrate de estar en el canal correcto antes de confirmar.]
    $addField[âŒ› DuraciÃ³n;<t:$json[time]:F> (<t:$json[time]:R>);false]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;gw-post-$authorID;ğŸ“¢ Publicar Giveaway;primary;;;]
    $addButton[no;gw-exit-$authorID;ğŸš« Cancelar proceso;danger;;;]
  $endif
$endif

$if[$customID==gw-post-$authorID]
  $jsonParse[$getVar[sysgive;$authorID]]
  $var[id;$json[id]]
  $httpGet[$var[api]/$json[id]?token=$var[token]]

  $if[$var[id]!=0]
    $title[ğŸ‰ | Giveaway Activo]
    $description[Â¡Un nuevo giveaway estÃ¡ activo! Â¡Participa ahora!]
    $addField[ğŸ† Premio;**$httpResult[data;prize]**;false]
    $addField[ğŸ“ Estado;**$httpResult[data;status]**;false]
    $addField[âŒ› Finaliza;<t:$json[time]:F> (<t:$json[time]:R>);false]
    $addField[Patrocinador;<@$httpResult[data;created_by_user_id]>;false]
    $addField[Ganadores;$httpResult[data;winners_count] ganador;false]
    $color[#9D4EDD]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;gw-join;ğŸ‘¤ Participar;primary;;;]
  $else
    $title[ğŸš« No hay detalles]
    $description[En este momento no se encuentra registrada ninguna Giveaway, inicia una para poder ver los detalles]
    $color[#FFD700]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
    $addButton[no;gw-main-$authorID;â†©ï¸ MenÃº Principal;primary;;;]
    $deleteIn[5s]
  $endif
$endif

$c[==========================================================================]
$c[                              PARTICIPAR (JOIN)                           ]
$c[==========================================================================]

$if[$customID==gw-join]
  $jsonParse[$getVar[sysgive;$authorID]]
  $httpGet[$var[api]/$json[id]/join?token=$var[token]&user_id=$authorID]

  $if[$httpResult[success]==true]
    $ephemeral
    $title[ğŸ‰ | Entrada confirmada]
    $description[Â¡Tu participaciÃ³n en este giveaway ha sido confirmada! Â¡Buena suerte!]
    $addField[Finaliza;<t:$json[time]:F> (<t:$json[time]:R>);false]
    $color[#9D4EDD]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
  $else
    $ephemeral
    $title[ğŸš« | Ya estÃ¡s participando]
    $description[Ya estÃ¡s registrado en este sorteo.]
    $addField[Finaliza;<t:$json[time]:F> (<t:$json[time]:R>);false]
    $color[#9D4EDD]
    $footer[Giveaway System By Methdev]
    $removeAllComponents
  $endif
$endif

$c[==========================================================================]
$c[                        CANCELAR PUBLICACIÃ“N (EXIT)                        ]
$c[==========================================================================]

$if[$customID==gw-exit-$authorID]
  $ephemeral
  $title[ğŸš« | PublicaciÃ³n cancelada]
  $description[Has cancelado el proceso de publicaciÃ³n del giveaway.
Puedes retomarlo cuando quieras desde **Gestionar â†’ Publicar** en este mismo panel.]
  $color[#FF4D4F]
  $footer[Giveaway System By Methdev]
  $removeAllComponents
  $addButton[no;gw-main-$authorID;â†©ï¸ MenÃº Principal;primary;;;]
$endif

$c[========================== âœ… FIN DEL SISTEMA ============================]